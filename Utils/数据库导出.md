# 指定数据库内容导出

使用数据库的`mysqldump `语法没法根据表名生成文件，一个一个改太浪费时间了

```java
/**
 * @Author: WangHn
 * @Date: 2024/3/20 16:19
 * @Description: 数据库表数据导出
 */
import java.io.*;
import java.sql.*;
import java.time.LocalDateTime;
import java.util.Arrays;
import java.util.List;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class DatabaseExporter {
    //数据库地址
    private static final String URL = "jdbc:mysql://127.0.0.2:3306/database_name?zeroDateTimeBehavior=convertToNull";
    //数据库连接名
    private static final String USER = "userName";
    //数据库连接密码
    private static final String PASSWORD = "password";
    //文件存储位置
    private static final String PATH = "D:\\DeskTop\\数据备份\\";

    //生成的表名
    private static List<String> tables =  Stream.of(
            "pdes_sys_appraisal_scheme",
            "pdes_sys_archives_class",
            "pdes_sys_archive_scope"
    ).collect(Collectors.toList());

    public static void main(String[] args) {
        try {
            Connection connection = DriverManager.getConnection(URL, USER, PASSWORD);
            ExecutorService executorService = Executors.newFixedThreadPool(10); // 5个线程

            tables.forEach(tableName->{
                        Runnable exportTask = new ExportTask(tableName,connection);
                        executorService.execute(exportTask);
                    }
            );
            executorService.shutdown();
            System.out.println("导出完成！");
        } catch (SQLException e) {
            throw new RuntimeException(e);
        }

    }

    private static class ExportTask implements Runnable {
        private String tableName;
        private Connection connection;

        public ExportTask(String tableName,Connection connection) {
            this.tableName = tableName;
            this.connection = connection;
        }

        @Override
        public void run() {
            try (Statement statement = connection.createStatement()) {
                // 执行查询
                ResultSet resultSet = statement.executeQuery("SELECT * FROM " + tableName);
                ResultSetMetaData metaData = resultSet.getMetaData();
                int columnCount = metaData.getColumnCount();

                // 创建文件夹
                File folder = new File(PATH);
                if (!folder.exists()) {
                    folder.mkdir();
                }

                // 创建输出文件
                File outputFile = new File(folder, tableName + ".sql");
                PrintWriter writer = new PrintWriter(new FileWriter(outputFile));

                // 写入INSERT语句
                while (resultSet.next()) {
                    StringBuilder values = new StringBuilder();
                    values.append("(");
                    for (int i = 1; i <= columnCount; i++) {
                        Object value = resultSet.getObject(i);
                        if (value instanceof String || value instanceof java.sql.Timestamp || value instanceof java.sql.Date || value instanceof java.sql.Time|| value instanceof LocalDateTime) {
                            values.append("'").append(value).append("'");
                        } else {
                            values.append(value);
                        }
                        if (i < columnCount) {
                            values.append(", ");
                        }
                    }
                    values.append(");");
                    writer.println("INSERT INTO " + tableName + " VALUES " + values.toString());
                }
                writer.close();
                System.out.println("表 " + tableName + " 导出完成！");
            } catch (SQLException | IOException e) {
                e.printStackTrace();
            }
        }
    }
}


```

